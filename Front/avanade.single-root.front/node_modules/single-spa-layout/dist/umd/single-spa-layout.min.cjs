/* single-spa-layout@3.0.0 - umd */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("single-spa")):"function"==typeof define&&define.amd?define(["exports","single-spa"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).singleSpaLayout={},e.singleSpa)}(this,(function(e,t){"use strict";function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s="undefined"!=typeof window;function l(e,t){if("object"!==o(t)||Array.isArray(t)||null===t)throw Error("Invalid ".concat(e,": received ").concat(Array.isArray(t)?"array":t," but expected a plain object"))}function d(e,t){if("boolean"!=typeof t)throw Error("Invalid ".concat(e,": received ").concat(o(t),", but expected a boolean"))}function f(e,t,n,r){if(!r){var o=Object.keys(t),a=[];o.forEach((function(e){n.indexOf(e)<0&&a.push(e)})),a.length>0&&console.warn(Error("Invalid ".concat(e,": received invalid properties '").concat(a.join(", "),"', but valid properties are ").concat(n.join(", "))))}}function p(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("string"!=typeof t||n&&""===t.trim())throw Error("Invalid ".concat(e,": received '").concat(t,"', but expected a").concat(n?" non-blank":""," string"))}function h(e,t){if(p(e,t),t.indexOf("/")<0)throw Error("Invalid ".concat(e,": received '").concat(t,"', but expected an absolute path that starts with /"))}function v(e,t,n){if(!Array.isArray(t)&&("object"!==o(o(t))||"number"!==t.length))throw Error("Invalid ".concat(e,": received '").concat(t,"', but expected an array"));for(var r=arguments.length,a=new Array(r>3?r-3:0),i=3;i<r;i++)a[i-3]=arguments[i];for(var c=0;c<t.length;c++)n.apply(void 0,[t[c],"".concat(e,"[").concat(c,"]")].concat(a))}function m(e,t){var n=[];return t.forEach((function(t){"application"===t.type?n.push(t):"route"===t.type?t.activeWhen(e)&&n.push(r(r({},t),{},{routes:m(e,t.routes)})):Array.isArray(t.routes)?n.push(r(r({},t),{},{routes:m(e,t.routes)})):n.push(t)})),n}function y(e,t){var n;return"/"===(n="/"===e.substr(-1)?"/"===t[0]?e+t.slice(1):e+t:"/"===t[0]?e+t:e+"/"+t).substr(-1)&&n.length>1&&(n=n.slice(0,n.length-1)),n}function g(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n];return null}var b="undefined"!=typeof Symbol?Symbol():"@";function w(e,t){if(s)return e.getAttribute(t);var n=g(e.attrs,(function(e){return e.name===t.toLowerCase()}));return n?n.value:null}function E(e,t){return s?e.hasAttribute(t):e.attrs.some((function(e){return e.name===t}))}function N(e,t,n){if("application"===e.nodeName.toLowerCase()){if(e.childNodes.length>0)throw Error("<application> elements must not have childNodes. You must put in a closing </application> - self closing is not allowed");var r={type:"application",name:w(e,"name")},o=w(e,"loader");if(o)if(t.loaders&&t.loaders.hasOwnProperty(o))r.loader=t.loaders[o];else if(s)throw Error("Application loader '".concat(o,"' was not defined in the htmlLayoutData"));var a=w(e,"error");if(a)if(t.errors&&t.errors.hasOwnProperty(a))r.error=t.errors[a];else if(s)throw Error("Application error handler '".concat(o,"' was not defined in the htmlLayoutData"));var c=w(e,"class");return c&&(r.className=c),A(e,r,t),[r]}if("route"===e.nodeName.toLowerCase()){var u={type:"route",routes:[]},l=w(e,"path");l&&(u.path=l),E(e,"default")&&(u.default=!0),E(e,"exact")&&(u.exact=!0),A(e,u,t);for(var d=0;d<e.childNodes.length;d++){var f;(f=u.routes).push.apply(f,i(N(e.childNodes[d],t,n)))}return[u]}if("redirect"===e.nodeName.toLowerCase())return n.redirects[y("/",w(e,"from"))]=y("/",w(e,"to")),[];if("undefined"!=typeof Node&&e instanceof Node){if(e.nodeType===Node.TEXT_NODE&&""===e.textContent.trim())return[];if(e.childNodes&&e.childNodes.length>0){e.routes=[];for(var p=0;p<e.childNodes.length;p++){var h;(h=e.routes).push.apply(h,i(N(e.childNodes[p],t,n)))}}return[e]}if(e.childNodes){for(var v={type:e.nodeName.toLowerCase(),routes:[],attrs:e.attrs},m=0;m<e.childNodes.length;m++){var g;(g=v.routes).push.apply(g,i(N(e.childNodes[m],t,n)))}return[v]}return"#comment"===e.nodeName?[{type:"#comment",value:e.data}]:"#text"===e.nodeName?[{type:"#text",value:e.value}]:void 0}function A(e,t,n){for(var r=(w(e,"props")||"").split(","),o=0;o<r.length;o++){var a=r[o].trim();if(0!==a.length)if(t.props||(t.props={}),n.props&&n.props.hasOwnProperty(a))t.props[a]=n.props[a];else{if(s)throw Error("Prop '".concat(a,"' was not defined in the htmlLayoutData. Either remove this attribute from the HTML element or provide the prop's value"));t.props[a]=b}}}function O(e){return{bootstrap:function(){return Promise.resolve()},mount:function(t){return Promise.resolve().then((function(){t.domElement.innerHTML=e}))},unmount:function(e){return Promise.resolve().then((function(){e.domElement.innerHTML=""}))}}}function C(e){return t=["application","route","fragment","assets","redirect"],n=e.type,!t.some((function(e){return e===n}));var t,n}function x(e,t){var n,r;return!!e&&(r=t instanceof Node?t:function(e){switch(e.type){case"#text":return document.createTextNode(e.value);case"#comment":return document.createComment(e.value);default:var t=document.createElement(e.type);return e.attrs.forEach((function(e){t.setAttribute(e.name,e.value)})),t}}(t),(n=e).nodeType===r.nodeType&&n.nodeName===r.nodeName&&function(e,t){var n=e.getAttributeNames?e.getAttributeNames().sort():[],r=e.getAttributeNames?e.getAttributeNames().sort():[];return n.length===r.length&&!n.some((function(n){return e.getAttribute(n)!==t.getAttribute(n)}))}(n,r))}function P(e){var t=e.location,n=e.routes,r=e.parentContainer,o=e.previousSibling,a=e.shouldMount,i=e.applicationContainers;return n.forEach((function(e,n){if("application"===e.type){if(a){var c,u=j(e.name);i[e.name]?c=i[e.name]:document.getElementById(u)?c=document.getElementById(u):(c=document.createElement("div")).id=u,"string"==typeof e.className?c.className=e.className:"string"!=typeof e.className&&"string"==typeof c.className&&c.removeAttribute("class"),S(c,r,o),o=c}}else if("route"===e.type)o=P({location:t,routes:e.routes,parentContainer:r,previousSibling:o,shouldMount:a&&e.activeWhen(t),applicationContainers:i});else if(e instanceof Node||"string"==typeof e.type)if(a){if(!e.connectedNode){var s=e instanceof Node?e.cloneNode(!1):T(e);e.connectedNode=s}S(e.connectedNode,r,o),e.routes&&P({location:t,routes:e.routes,parentContainer:e.connectedNode,previousSibling:null,shouldMount:a,applicationContainers:i}),o=e.connectedNode}else(l=e.connectedNode)&&(l.remove?l.remove():l.parentNode.removeChild(l)),delete e.connectedNode;var l})),o}function L(e){for(var t=e.applicationName,n=e.location,r=e.routes,o=0;o<r.length;o++){var a=r[o];if("application"===a.type){if(a.name===t)return a}else if("route"===a.type){if(a.activeWhen(n)){var i=L({applicationName:t,location:n,routes:a.routes});if(i)return i}}else if(a.routes){var c=L({applicationName:t,location:n,routes:a.routes});if(c)return c}}}function S(e,t,n){var r=n?n.nextSibling:t.firstChild;r!==e&&t.insertBefore(e,r)}function j(e){return"single-spa-application:".concat(e)}function T(e){if("#text"===e.type.toLowerCase())return document.createTextNode(e.value);if("#comment"===e.type.toLowerCase())return document.createComment(e.value);var t=document.createElement(e.type);return(e.attrs||[]).forEach((function(e){t.setAttribute(e.name,e.value)})),t.routes&&t.routes.forEach((function(e){t.appendChild(T(e))})),t}function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:location;return t["hash"===e.mode?"hash":"pathname"]}function I(e){try{return new URL(e)}catch(n){var t=document.createElement("a");return t.href=e,t}}function M(e){var n=[],r=t.checkActivityFunctions(e?I(e):location);return t.getAppNames().forEach((function(e){r.indexOf(e)<0&&n.push(e)})),n}function D(e,t,n,r){r.forEach((function(r){"application"===r.type?(e[r.name]||(e[r.name]=[]),e[r.name].push({activeWhen:t,props:R(n,r.props),loader:r.loader})):"route"===r.type?D(e,r.activeWhen,R(n,r.props),r.routes):r.routes&&D(e,t,n,r.routes)}))}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(r({},e),t)}function H(){return!0}e.constructApplications=function(e){var n=e.routes,r=e.loadApp,o={};return D(o,H,{},n.routes),Object.keys(o).map((function(e){var n=o[e];return{name:e,customProps:function(e,t){var r=g(n,(function(e){return e.activeWhen(t)}));return r?r.props:{}},activeWhen:n.map((function(e){return e.activeWhen})),app:function(){var o;s&&(o=g(n,(function(e){return e.activeWhen(window.location)})));var a=r({name:e});return o&&o.loader?function(e,n,r){return Promise.resolve().then((function(){var o,a=j(e),i=document.getElementById(a);i||((i=document.createElement("div")).id=a,i.style.display="none",document.body.appendChild(i),o=function(){i.style.removeProperty("display"),""===i.getAttribute("style")&&i.removeAttribute("style"),window.removeEventListener("single-spa:before-mount-routing-event",o)},window.addEventListener("single-spa:before-mount-routing-event",o));var u="string"==typeof n.loader?O(n.loader):n.loader,s=t.mountRootParcel(u,{name:"application-loader:".concat(e),domElement:i});function l(){return s.unmount().then((function(){o&&o()}))}return Promise.all([s.mountPromise,r]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(t,n)||c(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());r[0];var o=r[1];return l().then((function(){return o}))}),(function(e){return l().then((function(){throw e}))}))}))}(e,o,a):a}}}))},e.constructLayoutEngine=function(e){var n=e.routes;e.applications;var r=e.active,a=void 0===r||r,i=!1,c={},u=s&&Boolean(window.singleSpaLayoutData);if(!n)throw Error("single-spa-layout constructLayoutEngine(opts): opts.routes must be provided. Value was ".concat(o(n)));var l=n.base.slice(0,n.base.length-1),d={isActive:function(){return i},activate:function(){i||(i=!0,s&&(window.addEventListener("single-spa:before-routing-event",p),window.addEventListener("single-spa:before-mount-routing-event",h),window.addEventListener("single-spa:routing-event",v),t.addErrorHandler(f),u&&m(y(),n.routes),h()))},deactivate:function(){i&&(i=!1,s&&(window.removeEventListener("single-spa:before-routing-event",p),window.removeEventListener("single-spa:before-mount-routing-event",h),window.removeEventListener("single-spa:routing-event",v),t.removeErrorHandler(f)))}};return a&&d.activate(),d;function f(e){var r=L({applicationName:e.appOrParcelName,location:window.location,routes:n.routes});if(r&&r.error){var o=document.getElementById(j(r.name)),a="string"==typeof r.error?O(r.error):r.error;c[r.name]=t.mountRootParcel(a,{domElement:o,error:e})}setTimeout((function(){throw e}))}function p(e){var r=e.detail,a=r.cancelNavigation,i=r.newUrl,u=W(n,I(i)),s=function(e){var r=n.redirects[e];if(e===u){if(!a)throw Error("single-spa-layout: <redirect> requires single-spa@>=6.0.0");return a(),setTimeout((function(){t.navigateToUrl(r)})),{v:void 0}}};for(var l in n.redirects){var d=s(l);if("object"===o(d))return d.v}var f=[];M(i).forEach((function(e){c[e]&&(f.push(c[e].unmount()),delete c[e])})),f.length>0&&a(Promise.all(f).then((function(){return!1})))}function h(){if(0===W(n).indexOf(l)){var e=t.getMountedApps().reduce((function(e,t){return e[t]=document.getElementById(j(t)),e}),{});P({location:window.location,routes:n.routes,parentContainer:y(),shouldMount:!0,applicationContainers:e})}}function v(e){var t=e.detail,n=t.navigationIsCanceled,r=t.newUrl;n||M(r).forEach((function(e){var t=document.getElementById(j(e));t&&t.isConnected&&t.parentNode.removeChild(t)}))}function m(e,t){if(e&&e.childNodes&&t)for(var n={nextSibling:e.childNodes[0]},r=0;r<t.length;r++){var o,a=t[r];if("route"!==a.type){for(var i=null===(o=n)||void 0===o?void 0:o.nextSibling;(null===(c=i)||void 0===c?void 0:c.nodeType)===Node.TEXT_NODE&&""===i.textContent.trim();){var c;i=i.nextSibling}n=i,C(a)&&x(i,a)&&(a.connectedNode=i),a.routes&&m(i,a.routes)}else m(e,a.routes)}}function y(){return"string"==typeof n.containerEl?document.querySelector(n.containerEl):n.containerEl}},e.constructRoutes=function(e,n){if(e&&e.nodeName||"string"==typeof e){if(s&&!n&&window.singleSpaLayoutData&&(n=window.singleSpaLayoutData),"string"==typeof e){if(!s)throw Error("calling constructRoutes with a string on the server is not yet supported");if(!(e=(new DOMParser).parseFromString(e,"text/html").documentElement.querySelector("single-spa-router")))throw Error("constructRoutes should be called with a string HTML document that contains a <single-spa-router> element.")}e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("template"===e.nodeName.toLowerCase()&&(e=(e.content||e).querySelector("single-spa-router")),"single-spa-router"!==e.nodeName.toLowerCase())throw Error("single-spa-layout: The HTMLElement passed to constructRoutes must be <single-spa-router> or a <template> containing the router. Received ".concat(e.nodeName));s&&e.isConnected&&e.parentNode.removeChild(e);var n={routes:[],redirects:{}};w(e,"mode")&&(n.mode=w(e,"mode")),w(e,"base")&&(n.base=w(e,"base")),w(e,"containerEl")&&(n.containerEl=w(e,"containerEl"));for(var r=0;r<e.childNodes.length;r++){var o;(o=n.routes).push.apply(o,i(N(e.childNodes[r],t,n)))}return n}(e,n)}else if(n)throw Error("constructRoutes should be called either with an HTMLElement and layoutData, or a single json object.");return function(e){l("routesConfig",e);var n,r=e.disableWarnings;if(f("routesConfig",e,["mode","base","containerEl","routes","disableWarnings","redirects"],r),e.hasOwnProperty("containerEl")?function(e,t){if("string"==typeof t?""===t.trim():!(s&&t instanceof HTMLElement))throw Error("Invalid ".concat("routesConfig.containerEl",": received ").concat(t," but expected either non-blank string or HTMLElement"))}(0,e.containerEl):e.containerEl="body",e.hasOwnProperty("mode")||(e.mode="history"),function(e,t,n){if(n.indexOf(t)<0)throw Error("Invalid ".concat("routesConfig.mode",": received '").concat(t,"' but expected ").concat(n.join(", ")))}(0,e.mode,["history","hash"]),e.hasOwnProperty("base")?(p("routesConfig.base",e.base),e.base=(0!==(n=e.base).indexOf("/")&&(n="/"+n),"/"!==n[n.length-1]&&(n+="/"),n)):e.base="/",e.hasOwnProperty("redirects"))for(var o in l("routesConfig.redirects",e.redirects),e.redirects){var a=e.redirects[o];h("routesConfig.redirects key",o),h("routesConfig.redirects['".concat(o,"']"),a)}var i=s?window.location.pathname:"/",c="hash"===e.mode?i+"#":"";v("routesConfig.routes",e.routes,(function e(n,o,a){var i=a.parentPath,c=a.siblingActiveWhens,u=a.parentActiveWhen;if(l(o,n),"application"===n.type)f(o,n,["type","name","props","loader","error","className"],r),n.props&&l("".concat(o,".props"),n.props),p("".concat(o,".name"),n.name);else if("route"===n.type){f(o,n,["type","path","routes","props","default","exact"],r),n.hasOwnProperty("exact")&&d("".concat(o,".exact"),n.exact);var s,h=n.hasOwnProperty("path"),m=n.hasOwnProperty("default");if(h)p("".concat(o,".path"),n.path),s=y(i,n.path),n.activeWhen=t.pathToActiveWhen(s,n.exact),c.push(n.activeWhen);else{if(!m)throw Error("Invalid ".concat(o,": routes must have either a path or default property."));d("".concat(o,".default"),n.default),s=i,n.activeWhen=function(e,t){return function(n){return t(n)&&!e.some((function(e){return e(n)}))}}(c,u)}if(h&&m&&n.default)throw Error("Invalid ".concat(o,": cannot have both path and set default to true."));n.routes&&v("".concat(o,".routes"),n.routes,e,{parentPath:s,siblingActiveWhens:[],parentActiveWhen:n.activeWhen})}else{if("undefined"!=typeof Node&&n instanceof Node);else for(var g in n)"routes"!==g&&"attrs"!==g&&p("".concat(o,"['").concat(g,"']"),n[g],!1);n.routes&&v("".concat(o,".routes"),n.routes,e,{parentPath:i,siblingActiveWhens:c,parentActiveWhen:u})}}),{parentPath:c+e.base,parentActiveWhen:function(){return!0},siblingActiveWhens:[]}),delete e.disableWarnings}(e),e},e.matchRoute=function(e,t){p("path",t);var n=r({},e),o=e.base.slice(0,e.base.length-1);if(0===t.indexOf(o)){var a=s?window.location.origin:"http://localhost",i=new URL(y(a,t));n.routes=m(i,e.routes)}else n.routes=[];return n},Object.defineProperty(e,"__esModule",{value:!0})}));
